# entry point for creating K8s configuration files
- name: Create directory for configuration files
  delegate_to: localhost
  file:
    path: configuration
    state: directory

- name: Create initial etcd cluster string
  set_fact:
    etcd_cluster_member: "{{ inventory_hostname }}=https://{{ ansible_host }}:2380"

- name: Assemble etcd initial cluster string
  set_fact:
    etcd_initial_cluster: "{{ groups['etcd_hosts'] | map('extract', hostvars, ['etcd_cluster_member']) | join(',') }}"

- name: Create etcd configuration file
  delegate_to: localhost
  template:
    src: templates/etcd_service.j2
    dest: configuration/etcd-{{ inventory_hostname }}_service
